# Инструкция по запуску задач Celery

В этом проекте используется Celery для выполнения асинхронных задач и периодических задач с помощью Celery Beat.

## Доступные задачи

### Задачи в app_order
- `clear_orders`: Ежедневная очистка заказов в 08:00

### Задачи в app_catalog
- `activate_combo_category`: Активация категории "Комбо" в рабочие дни (пн-пт) в 11:00
- `deactivate_combo_category`: Деактивация категории "Комбо" в 17:00 или в выходные дни

## Скрипты для запуска

В проекте доступны следующие скрипты для запуска Celery:

### 1. Запуск только Celery Worker

```bash
./run_celery_worker.sh
```

Этот скрипт запускает только воркер Celery, который обрабатывает задачи, но не запускает планировщик.

### 2. Запуск только Celery Beat

```bash
./run_celery_beat.sh
```

Этот скрипт запускает только планировщик Celery Beat, который отправляет периодические задачи в очередь.

### 3. Запуск Celery Worker и Beat вместе

```bash
./run_celery.sh
```

Этот скрипт запускает и воркер Celery, и планировщик Celery Beat одновременно. Воркер запускается в фоновом режиме, а планировщик - в основном процессе.

### 4. Запуск конкретной задачи

```bash
./run_celery_task.sh <имя_задачи> [аргументы]
```

Этот скрипт позволяет запустить конкретную задачу Celery. Например:

```bash
./run_celery_task.sh app_catalog.tasks.activate_combo_category
./run_celery_task.sh app_order.tasks.clear_orders
```

### 5. Остановка процессов Celery

```bash
./stop_celery.sh
```

Этот скрипт находит и останавливает все запущенные процессы Celery worker и Celery Beat.

## Настройка

Если вы используете виртуальное окружение, раскомментируйте соответствующие строки в скриптах:

```bash
# Активируем виртуальное окружение, если оно используется
source venv/bin/activate
```

## Мониторинг

### Запуск Flower для мониторинга

```bash
./run_celery_flower.sh
```

Этот скрипт запускает Flower - веб-интерфейс для мониторинга задач Celery. После запуска, интерфейс будет доступен по адресу http://localhost:5555

Flower позволяет:
- Отслеживать активные, завершенные и неудачные задачи
- Просматривать статистику выполнения
- Управлять воркерами
- Запускать задачи вручную

## Конфигурация

Конфигурация Celery находится в следующих файлах:
- `SoloPizza/celery.py`: Основная конфигурация Celery
- `SoloPizza/celerybeat_schedule.py`: Расписание периодических задач
- `settings.py`: Настройки брокера сообщений (Redis) и бэкенда результатов